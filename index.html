<html>
  <head>
    <link rel="stylesheet" href="style.css" type="text/css"/>
    <script type="text/javascript"
      src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script src="client.js" type="text/javascript"></script>
    <title>node chat</title>
    <style type="text/css">
      .joinChat {
        padding: 10px;
      }
	  #createChat
	  {
		border:1px solid #777777;
		font-family:inherit;
		font-size:15px;
		padding:4px;
		width:400px;
	  }
	  
	  #create{
		-moz-border-radius:2px 2px 2px 2px;
		background-color:#333333;
		border:1px solid #333333;
		color:#FFFFFF;
		font-family:inherit;
		font-size:15px;
		font-weight:bold;
		margin-left:3px;
		padding:3px 8px 4px;
		text-shadow:0 1px 2px #000000;
	  }
	  
	  #app
	  {
		  width:900px;
		  margin:0 auto;
		  padding:15px;
		  border:1px solid #333;
	  }
    </style>
	<script type="text/javascript">
		function updateChats(chats){
			for(c in chats.rooms)
			{
				//var link = "<a class='joinChat' href='"+c+"'>"+chats.rooms[c].title+"</a>";
			  var l = document.createElement("a");
			  l.setAttribute('href', c);
			  l.innerHTML = chats.rooms[c].title;
        l.className = 'joinChat';
			  $("#currentChats").append(l);
			}
		}
	
		$(document).ready(function(){
			$.ajax({ cache: false
           , type: "GET" // XXX should be POST
           , dataType: "json"
           , url: "/getchats"
           , data: {}
           , error: function () {
               alert("error creating chat");
               showConnect();
             }
           , success: updateChats
           });		
		});
	</script>
  </head>
  <body>
    <div id="app">
      <div id="connect">
<div id="fbConnect"><fb:login-button autologoutlink="true"></fb:login-button></div>
        <form action="#">
          <fieldset> 
            <p>
              Create a Chat</p>
            <input style="width:400px; line-height:140%; padding:5px;"id="createChat">
            <input name="createChat" type="button" id="create" value="Create">
          </fieldset>
        </form>
		<div id="currentChats">
			
		</div>
      </div>
      <div id="loading"><p>loading</p></div>
      <div id="log"></div>
      <div id="toolbar">
        <ul id="status">
          <li><a id="usersLink" href="#">5 users</a></li>
          <li>uptime: <span id="uptime">?</span></li>
          <li><a href="#" id="leave">leave chat</a></li>
        </ul>
        <input tabindex="1" type="text" id="entry"/>
      </div>
      </div>
    <div id="fb-root"></div>
    <script>
      window.fbAsyncInit = function() {
        FB.init({appId: '165425556817740', status: true, cookie: true,
                 xfbml: true});
        
		FB.getLoginStatus(function(response) {
		if (response.session) {
			// logged in and connected user, someone you know
			FB.api('/me', function(me) {
        CONFIG.name = me.name;
        CONFIG.url = me.link;
        CONFIG.id = me.id;
        CONFIG.pic =
        'https://graph.facebook.com/'+CONFIG.id+'/picture?access_token='+
          encodeURIComponent(response.session.access_token);
//        onLogin();
      });
              
		} else {
		// no user session available, someone you dont know
		}
		});
		
        FB.Event.subscribe('auth.login', function(response) {
          // do something with response.session
          	FB.api('/me', function(response) {
//          		onLogin(response.name);
        	});
        });
      };
      (function() {
        var e = document.createElement('script');
        e.type = 'text/javascript';
        e.src = document.location.protocol +
          '//connect.facebook.net/en_US/all.js';
        e.async = true;
        document.getElementById('fb-root').appendChild(e);
      }());
    </script>
  </body>
</html>
