<html>
  <head>
    <link rel="stylesheet" href="style.css" type="text/css"/>
    <script src="jquery-1.2.6.min.js" type="text/javascript"></script>
    <script src="client.js" type="text/javascript"></script>
    <script type="text/javascript">
      function onLogin (name){
    //lock the UI while waiting for a response
    showLoad();
    var nick = name;

    //dont bother the backend if we fail easy validations
    if (nick.length > 50) {
      alert("Nick too long. 50 character max.");
      showConnect();
      return false;
    }

    //more validations
    if (/[^\w\W_\-^!]/.exec(nick)) {
      alert("Bad character in nick. Can only have letters, numbers, and '_', '-', '^', '!'");
      showConnect();
      return false;
    }

    //make the actual join request to the server
    $.ajax({ cache: false
           , type: "GET" // XXX should be POST
           , dataType: "json"
           , url: "/join"
           , data: { nick: nick }
           , error: function () {
               alert("error connecting to server");
               showConnect();
             }
           , success: onConnect
           });
    return false;
  }
	  
	  
    </script>
    <title>node chat</title>
  </head>
  <body>
    <div id="app">
      <div id="connect">
<div id="fbConnect"><fb:login-button autologoutlink="true"></fb:login-button></div>
        <div id="name"></div>
        <form action="#">
          <fieldset> 
            <p>
              This is a chat room. Both the client-side and server-side are
              written in javascript. The source code is
              <a href="http://github.com/ry/node_chat/tree/master">here</a>.
            </p>

            <label for="nick">Name</label>
            <input id="nickInput" class="text"type="text" name="nick" value=""/>
            <input id="connectButton" class="button" type="submit" name="" value="Join"/>

          </fieldset>
        </form>
      </div>
      <div id="loading"><p>loading</p></div>
      <div id="log"></div>
      <div id="toolbar">
        <ul id="status">
          <li><a id="usersLink" href="#">5 users</a></li>
          <li>uptime: <span id="uptime">?</span></li>
          <li>memory: <span id="rss">?</span>mb RSS</li>
        </ul>
        <input tabindex="1" type="text" id="entry"/>
      </div>
    <div id="fb-root"></div>
    <script>
      window.fbAsyncInit = function() {
        FB.init({appId: '165425556817740', status: true, cookie: true,
                 xfbml: true});
        
        FB.Event.subscribe('auth.login', function(response) {
          // do something with response.session
          	FB.api('/me', function(response) {
          		onLogin(response.name);
        	});
        });
      };
      (function() {
        var e = document.createElement('script');
        e.type = 'text/javascript';
        e.src = document.location.protocol +
          '//connect.facebook.net/en_US/all.js';
        e.async = true;
        document.getElementById('fb-root').appendChild(e);
      }());
    </script>
  </body>
</html>
